{% extends "base.html" %}

{% block title %}
Mentora Â· AI PPT Generator
{% endblock %}

{% block header %}
<h2 class="text-xl font-bold">AI PPT Generator</h2>
{% endblock %}

{% block extra_head %}
<style>
    .dot {
        width: 6px;
        height: 6px;
        background: #14b8a6;
        border-radius: 50%;
        display: inline-block;
        animation: blink 1.4s infinite both;
    }

    .dot:nth-child(2) { animation-delay: 0.2s; }
    .dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes blink {
        0% { opacity: .2; }
        20% { opacity: 1; }
        100% { opacity: .2; }
    }

    .generating-text {
        animation: fadeText 1.4s infinite linear;
    }

    @keyframes fadeText {
        0%,100% { opacity: 0.4; }
        50% { opacity: 1; }
    }

    #toast {
        opacity: 0;
        transform: translateY(-20px);
        z-index: 9999;
    }

    .toast-show {
        opacity: 1 !important;
        transform: translateY(0) !important;
    }

    .toast-success {
        background: #d1fae5;
        border-left: 4px solid #10b981;
        color: #065f46;
    }

    .toast-error {
        background: #fee2e2;
        border-left: 4px solid #dc2626;
        color: #7f1d1d;
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">

    <div class="bg-white rounded-xl p-6 md:p-8 shadow-soft border border-slate-100 space-y-6">

        <div class="text-center">
            <h1 class="text-2xl font-bold">Create Your Presentation</h1>
            <p class="mt-2 text-text-secondary">
                Fill in the details below to generate your PPT using AI.
            </p>
        </div>

        <form id="pptForm" class="space-y-6">

            <!-- Topic -->
            <div>
                <label class="block text-sm font-medium text-text-secondary mb-2">Topic</label>
                <input id="topic"
                       class="w-full rounded-lg border px-4 py-3 focus:border-primary focus:ring-primary"
                       placeholder="e.g. The Future of Renewable Energy">
            </div>

            <!-- Description -->
            <div>
                <label class="block text-sm font-medium text-text-secondary mb-2">Description</label>
                <textarea id="description"
                          rows="4"
                          class="w-full rounded-lg border px-4 py-3 focus:border-primary focus:ring-primary"
                          placeholder="Goals, audience, tone..."></textarea>
            </div>

            <!-- Slides -->
            <div>
                <label class="block text-sm font-medium text-text-secondary mb-2">
                    Number of Slides
                </label>
                <input id="slides"
                       type="number"
                       min="5"
                       max="20"
                       value="10"
                       class="w-full rounded-lg border px-4 py-3 focus:border-primary focus:ring-primary">
            </div>

            <!-- Toast -->
            <div id="toast"
                 class="fixed top-20 right-6 px-4 py-3 rounded-lg text-sm shadow-lg transition-all duration-300">
            </div>

            <!-- Actions -->
            <div class="flex flex-col sm:flex-row sm:justify-end gap-4 pt-4">

                <button id="generateBtn"
                        type="button"
                        class="flex items-center justify-center gap-2
                               bg-primary text-white px-6 py-3 rounded-lg font-semibold
                               hover:bg-primary-hover transition">
                    <span class="material-symbols-outlined">auto_awesome</span>
                    <span id="generateText">Generate PPT</span>

                    <span id="genDots" class="hidden flex gap-1 ml-1">
                        <span class="dot"></span>
                        <span class="dot"></span>
                        <span class="dot"></span>
                    </span>
                </button>

                <button id="downloadBtn"
                        type="button"
                        disabled
                        class="flex items-center justify-center gap-2
                               border px-6 py-3 rounded-lg text-text-secondary
                               hover:bg-slate-50 transition">
                    <span class="material-symbols-outlined">download</span>
                    Download PPT
                </button>

            </div>

        </form>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

    const generateBtn = document.getElementById("generateBtn");
    const generateText = document.getElementById("generateText");
    const genDots = document.getElementById("genDots");
    const downloadBtn = document.getElementById("downloadBtn");

    const topic = document.getElementById("topic");
    const desc = document.getElementById("description");
    const slides = document.getElementById("slides");
    const toast = document.getElementById("toast");

    let generatedFile = null;

    function showToast(msg, type="success") {
        toast.className = "fixed top-20 right-6 px-4 py-3 rounded-lg text-sm shadow-lg transition-all duration-300";
        toast.textContent = msg;
        toast.classList.add(type === "success" ? "toast-success" : "toast-error");
        requestAnimationFrame(() => toast.classList.add("toast-show"));
        setTimeout(() => toast.classList.remove("toast-show"), 2500);
    }

    function startGenerating() {
        generateBtn.disabled = true;
        generateText.textContent = "Generating";
        generateText.classList.add("generating-text");
        genDots.classList.remove("hidden");
    }

    function stopGenerating() {
        generateBtn.disabled = false;
        generateText.textContent = "Generate PPT";
        generateText.classList.remove("generating-text");
        genDots.classList.add("hidden");
    }

    generateBtn.onclick = async () => {
        if (!topic.value || !desc.value || slides.value < 5 || slides.value > 20) {
            showToast("Please fill all fields correctly.", "error");
            return;
        }

        startGenerating();

        try {
            const res = await fetch("/ppt/generate", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    topic: topic.value,
                    description: desc.value,
                    slides: parseInt(slides.value)
                })
            });

            const blob = await res.blob();
            generatedFile = URL.createObjectURL(blob);
            downloadBtn.disabled = false;
            showToast("PPT generated successfully!");

        } catch {
            showToast("Failed to generate PPT.", "error");
        }

        stopGenerating();
    };

    downloadBtn.onclick = () => {
        if (!generatedFile) return;
        const a = document.createElement("a");
        a.href = generatedFile;
        a.download = topic.value.replace(/ /g, "_") + ".pptx";
        a.click();
        generatedFile = null;
        downloadBtn.disabled = true;
    };

});
</script>
{% endblock %}
